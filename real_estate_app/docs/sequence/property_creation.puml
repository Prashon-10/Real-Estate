@startuml Property_Creation_Sequence

title Agent Property Creation Process

actor Agent as A
participant "Property Form" as PF
participant "Django Views" as DV
participant "Property Model" as PM
participant "PropertyImage Model" as PIM
participant "File Storage" as FS
participant "Database" as DB

A -> PF : Fill property details + upload images
activate PF

PF -> DV : POST /properties/create/
activate DV

DV -> DV : Check user is agent
DV -> DV : Validate property form
DV -> DV : Validate image forms

alt Valid Data
    DV -> PM : Create property instance
    activate PM
    PM -> PM : Set agent = current_user
    PM -> DB : Save property
    activate DB
    DB -> PM : Property ID
    deactivate DB
    PM -> DV : Property object
    deactivate PM
    
    loop For each uploaded image
        DV -> FS : Store image file
        activate FS
        FS -> DV : File path
        deactivate FS
        
        DV -> PIM : Create PropertyImage
        activate PIM
        PIM -> PIM : Set property + image + order
        PIM -> DB : Save image record
        activate DB
        DB -> PIM : Image ID
        deactivate DB
        deactivate PIM
    end
    
    DV -> PF : Success message
    PF -> A : "Property created successfully"
    
else Invalid Data
    DV -> PF : Validation errors
    PF -> A : Show error messages
    
else Not Agent
    DV -> PF : Access denied
    PF -> A : "Agent access required"
end

deactivate DV
deactivate PF

note right of PM
  Property status defaults
  to 'available' when created
end note

note right of PIM
  Images are ordered starting
  from 0 for display purposes
end note

@enduml
